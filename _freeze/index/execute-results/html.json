{
  "hash": "7409da20aa853bb98bbe072685895881",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Selectivity Options for Age-Structured Stock Assessments\"\nsubtitle: \"A comparative framework using RTMB\"\nauthor:\n  - name: James Ianelli\n    affiliations:\n      - name: NOAA/NMFS Alaska Fisheries Science Center\n        city: Seattle\n        state: WA\ndate: last-modified\nabstract: |\n  Selectivity is a fundamental component of age-structured stock assessment models,\n  governing how fishing mortality and survey catchability vary with age or size. The\n  choice of selectivity parameterization affects estimates of population abundance,\n  fishing mortality, and management reference points. This manuscript compares several\n  selectivity formulations---including standard logistic, double logistic,\n  spline-based, and time-varying 2D autoregressive approaches---within a unified\n  RTMB framework. We examine parameter\n  identifiability, prior sensitivity, and the practical consequences of selectivity\n  misspecification using simulation and application to eastern Bering Sea walleye\n  pollock (*Gadus chalcogrammus*). Results highlight trade-offs between flexibility\n  and estimability and provide guidance for practitioners choosing among selectivity\n  options in operational assessments.\nkeywords:\n  - selectivity\n  - stock assessment\n  - RTMB\n  - fisheries\n  - walleye pollock\n---\n\n## Introduction {#sec-intro}\n\nSelectivity functions describe the relative vulnerability of fish to capture as a\nfunction of age (or size) and are among the most influential---yet least\nobservable---components of stock assessment models. The assumed shape of the\nselectivity curve directly affects estimates of spawning biomass, recruitment, and\nfishing mortality, and misspecification can propagate into biased reference points\nand management advice [@punt2013; @thompson1994].\n\nDespite its importance, selectivity is often treated as a modelling convenience\nrather than a biological or technological quantity to be estimated carefully. Most\noperational assessments adopt a logistic or double-logistic functional form, chosen\nfor parsimony rather than fidelity to the underlying catch process. More flexible\nalternatives---such as penalized splines or non-parametric approaches---can reduce\nstructural bias but may introduce identifiability problems, particularly when data\nare sparse or conflicting.\n\nThis manuscript develops a comparative framework for evaluating selectivity options\nwithin the R Template Model Builder (RTMB) environment. RTMB provides automatic\ndifferentiation, Laplace approximation for random effects, and integration with\nBayesian sampling via SparseNUTS, making it a natural platform for exploring both\nmaximum likelihood and posterior-based inference on selectivity parameters.\n\nWe organize the comparison around four selectivity families:\n\n1. **Standard logistic** (@sec-logistic): the two-parameter ascending logistic,\n   widely used for fisheries where retention is assumed to be monotonically\n   increasing with age.\n2. **Double logistic** (@sec-double-logistic): a dome-shaped three-parameter\n   formulation allowing selectivity to decline at older ages, motivated by gear\n   avoidance, ontogenetic habitat shifts, or differential availability.\n3. **Spline-based** (@sec-spline): a penalized B-spline approach offering flexible,\n   data-driven selectivity shapes with smoothness controlled by a penalty parameter.\n4. **Time-varying 2D AR1** (@sec-timevarying): a separable autoregressive structure\n   over year and age dimensions, allowing selectivity to evolve smoothly through\n   time while maintaining age-specific coherence via a Kronecker-structured\n   precision matrix.\n\nFor each family, we present the mathematical formulation, an RTMB implementation\nwith prior specification, parameter sensitivity analysis, and MCMC-based posterior\nevaluation. We then apply all to eastern Bering Sea walleye pollock data to\nillustrate practical trade-offs.\n\n\n## Standard Logistic Selectivity {#sec-logistic}\n\n---\ntitle: \"Standard Logistic Selectivity\"\nsubtitle: \"Two-parameter ascending logistic formulation\"\n---\n\n## Overview\n\nThe standard (ascending) logistic selectivity is the simplest and most commonly\nused parameterization in age-structured stock assessments. It assumes that\nselectivity increases monotonically with age and asymptotes at full selectivity.\n\n## Model definition\n\nWith parameters $a_{50}$ (age at 50% selectivity) and $\\delta$ (slope width from\n50% to 95% selectivity):\n\n$$\n\\text{sel}(a) = \\frac{1}{1 + \\exp\\left[-\\log(19)\\,\\frac{a - a_{50}}{\\delta}\\right]}\n$$\n\nwhere $\\delta > 0$ controls how quickly selectivity transitions from low to high\nvalues.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(patchwork)\n\nlogistic_sel <- function(age, a50, delta) {\n  1 / (1 + exp(-log(19) * (age - a50) / delta))\n}\n\nages <- seq(1, 15, by = 0.1)\n```\n:::\n\n\n## Scenario exploration\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscenarios <- expand_grid(\n  a50 = c(3, 5, 7),\n  delta = c(0.5, 1.5, 3.0),\n  age = ages\n) %>%\n  mutate(\n    selectivity = logistic_sel(age, a50, delta),\n    label = sprintf(\"a50 = %g, delta = %g\", a50, delta)\n  )\n\nggplot(scenarios, aes(x = age, y = selectivity, color = factor(delta))) +\n  geom_line(linewidth = 1) +\n  facet_wrap(~ paste(\"a50 =\", a50)) +\n  geom_hline(yintercept = c(0.5, 0.95), linetype = \"dashed\",\n             color = \"gray50\", alpha = 0.7) +\n  scale_color_viridis_d(name = \"delta\") +\n  scale_y_continuous(limits = c(0, 1.05)) +\n  labs(x = \"Age\", y = \"Selectivity\") +\n  theme_bw(base_size = 11) +\n  theme(panel.grid.minor = element_blank())\n```\n\n::: {.cell-output-display}\n![Standard logistic selectivity under different parameterizations.](index_files/figure-html/fig-logistic-scenarios-1.png){#fig-logistic-scenarios width=672}\n:::\n:::\n\n\n## RTMB implementation\n\n*Placeholder: RTMB objective function with priors on $a_{50}$ and $\\delta$,\noptimization, and MCMC sampling.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(RTMB)\n\n# Objective function skeleton\nf <- function(parms) {\n  getAll(data, parms, warn = FALSE)\n  a50 <- exp(log_a50)\n  delta <- exp(log_delta)\n  sel_hat <- logistic_sel(age, a50, delta)\n\n  nll <- 0\n  # Priors\n  nll <- nll - dnorm(log_a50, mu_log_a50, sd_log_a50, log = TRUE)\n  nll <- nll - dnorm(log_delta, mu_log_delta, sd_log_delta, log = TRUE)\n\n  ADREPORT(c(a50 = a50, delta = delta))\n  nll\n}\n```\n:::\n\n\n\n\n## Double Logistic Selectivity {#sec-double-logistic}\n\nFull section: [Double Logistic Selectivity](double_logistic_selectivity.html).\n\n\n## Spline-Based Selectivity {#sec-spline}\n\nFull section: [Spline-Based Selectivity](spline_selectivity.html).\n\n\n## Time-Varying Selectivity with 2D Autoregressive Structure {#sec-timevarying}\n\nFull section: [Time-Varying Selectivity with 2D Autoregressive Structure](timevarying_selectivity.html).\n\n\n## Comparison and Discussion {#sec-discussion}\n\n*Placeholder: comparative analysis across selectivity families, including AIC/BIC,\nposterior predictive checks, and implications for management quantities.*\n\n\n## References {.unnumbered}\n\n::: {#refs}\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}